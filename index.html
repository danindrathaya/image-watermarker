<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Watermark</title>
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom font */
      body {
        font-family: "Inter", sans-serif;
      }
      /* Ensure canvas is responsive but doesn't overflow */
      canvas {
        max-width: 100%;
        height: auto;
        display: none; /* Hide until image is loaded */
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl w-full max-w-lg">
      <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6">
        Image Watermarker
      </h1>

      <!-- Form Inputs -->
      <div class="space-y-4">
        <div>
          <label
            for="imageLoader"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            Upload Image
          </label>
          <input
            type="file"
            id="imageLoader"
            accept="image/*"
            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition-colors"
          />
        </div>

        <div>
          <label
            for="watermarkText"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            Watermark Text
          </label>
          <input
            type="text"
            id="watermarkText"
            placeholder="Verifikasi Stockbit - 01/01/2000"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
        </div>

        <button
          id="watermarkButton"
          class="w-full bg-blue-600 text-white font-bold py-2.5 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all transform hover:scale-[1.02]"
        >
          Apply Watermark
        </button>
      </div>

      <!-- Canvas for processing -->
      <div class="mt-6 border-t border-gray-200 pt-6">
        <h2 class="text-lg font-semibold text-gray-700 mb-4 text-center">
          Preview
        </h2>
        <div
          id="canvasContainer"
          class="bg-gray-50 p-4 rounded-lg border border-gray-200 flex justify-center items-center min-h-[200px]"
        >
          <canvas id="imageCanvas" class="rounded-md shadow-inner"></canvas>
          <p id="placeholderText" class="text-gray-400">
            Your image will appear here
          </p>
        </div>
      </div>

      <!-- Download Link -->
      <div class="mt-4 text-center">
        <a
          id="downloadLink"
          class="inline-block bg-green-600 text-white font-bold py-2.5 px-6 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-all transform hover:scale-[1.02] hidden"
        >
          Download Image
        </a>
      </div>
    </div>

    <script>
      const imageLoader = document.getElementById("imageLoader");
      const watermarkText = document.getElementById("watermarkText");
      const watermarkButton = document.getElementById("watermarkButton");
      const canvas = document.getElementById("imageCanvas");
      const ctx = canvas.getContext("2d");
      const downloadLink = document.getElementById("downloadLink");
      const placeholderText = document.getElementById("placeholderText");

      let originalImage = null;

      // 1. Load the image
      imageLoader.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) {
          return;
        }

        const reader = new FileReader();

        reader.onload = (event) => {
          const img = new Image();
          img.onload = () => {
            // Store the original image
            originalImage = img;

            // Set canvas dimensions
            canvas.width = img.width;
            canvas.height = img.height;

            // Draw the image
            ctx.drawImage(img, 0, 0);

            // Show canvas and hide placeholder
            canvas.style.display = "block";
            placeholderText.style.display = "none";

            // Clear any previous download link
            downloadLink.classList.add("hidden");
            downloadLink.href = "#";
          };
          img.src = event.target.result;
        };

        reader.readAsDataURL(file);
      });

      // 2. Apply the watermark
      watermarkButton.addEventListener("click", () => {
        if (!originalImage) {
          // We can't use alert, so let's log to console and maybe update UI
          console.error("No image loaded!");
          placeholderText.textContent = "Please upload an image first!";
          placeholderText.style.color = "#EF4444"; // red-500
          return;
        }

        const text = watermarkText.value;
        if (!text) {
          console.error("No watermark text entered!");
          // We could also show a message, but for simplicity, we'll just require text.
          return;
        }

        // Redraw the original image to clear previous watermarks
        ctx.drawImage(originalImage, 0, 0);

        // --- Style the watermark ---
        // Calculate font size based on image width (e.g., 5% of width)
        let fontSize = Math.floor(canvas.width * 0.05);
        // Ensure font size is not too small
        fontSize = Math.max(fontSize, 20);

        ctx.font = `bold ${fontSize}px Arial`;
        ctx.fillStyle = "rgba(255, 255, 255, 0.5)"; // Semi-transparent white
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        // Calculate position (center of the canvas)
        const x = canvas.width / 2;
        const y = canvas.height / 2;

        // Draw the text
        ctx.fillText(text, x, y);

        // 3. Prepare download
        downloadLink.href = canvas.toDataURL("image/png"); // Create data URL
        downloadLink.download = "watermarked-image.png"; // Set filename
        downloadLink.classList.remove("hidden"); // Show the download button
      });
    </script>
  </body>
</html>
